var request = require("request");
var Q = require("q");
var util = require('./util');

function key(email, password, name, type, validUntil, maxUses){
    var deferred = Q.defer();
    
    request({
        url: util.getAPIUrl("/auth/key"),
        method: 'POST',
        json: {
            email: email,
            password: password,
            name: name,
            type: type,
            validUntil: validUntil,
            maxUses: maxUses
        }
    }, function(err, res, body){
        if(!err){
            deferred.resolve(body);
        } else {
            deferred.reject(err);
        }
    });    
    
    return deferred.promise;
}

(function($){
    $.login = "loginFKT";
    $.logout = "logoutFKT";
    $.key = key;
})(exports);
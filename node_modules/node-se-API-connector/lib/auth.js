var request = require("request");
var Q = require("q");
var util = require('./util');

function key(email, password, name, type, validUntil, maxUses){
    var deferred = Q.defer();
    
    var url = util.getAPIUrl("/auth/key");
    
    console.log(url);
    
    request({
        url: url,
        method: 'POST',
        json: {
            email: email,
            password: password,
            name: name,
            type: type,
            validUntil: validUntil,
            maxUses: maxUses
        }
    }, function(error, res, body){
        console.log(res);
        if(!error){
            deferred.resolve(body);
        } else {
            deferred.reject(error);
        }
    });    
    
    return deferred.promise;
}

(function($){
    $.login = "loginFKT";
    $.logout = "logoutFKT";
    $.key = key;
})(exports);